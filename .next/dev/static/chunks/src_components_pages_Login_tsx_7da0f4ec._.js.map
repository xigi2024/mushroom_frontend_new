{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/mycomatrix/mushroom%20frontend/src/components/pages/Login.tsx"],"sourcesContent":["\"use client\";\r\nimport React, { useState } from \"react\";\r\nimport \"bootstrap/dist/css/bootstrap.min.css\";\r\nimport { FiMail, FiLock, FiEye, FiEyeOff } from \"react-icons/fi\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { ToastContainer, toast } from \"react-toastify\";\r\nimport \"react-toastify/dist/ReactToastify.css\";\r\nimport { Row, Col, Container } from \"react-bootstrap\";\r\nimport \"../styles/login.css\";\r\nimport { useAuth } from \"../../context/AuthContext\";\r\nconst mushroomImg = \"/assets/mushoom-img.jpg\";\r\n\r\ninterface LoginForm {\r\n  email: string;\r\n  password: string;\r\n}\r\n\r\n// Add interface for errors\r\ninterface LoginErrors {\r\n  email?: string;\r\n  password?: string;\r\n}\r\n\r\nconst Login = () => {\r\n  const navigate = useRouter();\r\n  const { login } = useAuth();\r\n\r\n  const [formData, setFormData] = useState<LoginForm>({\r\n    email: \"\",\r\n    password: \"\",\r\n  });\r\n\r\n  // Fix: Type the errors state properly\r\n  const [errors, setErrors] = useState<LoginErrors>({});\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [showPassword, setShowPassword] = useState(false);\r\n\r\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const { name, value } = e.target;\r\n    setFormData((prev) => ({\r\n      ...prev,\r\n      [name]: value,\r\n    }));\r\n\r\n    if (errors[name as keyof LoginErrors]) {\r\n      setErrors((prev) => ({ ...prev, [name]: null }));\r\n    }\r\n  };\r\n\r\n  const validateForm = () => {\r\n    const newErrors: LoginErrors = {};\r\n\r\n    if (!formData.email.trim()) {\r\n      newErrors.email = \"Email is required\";\r\n    } else if (!/\\S+@\\S+\\.\\S+/.test(formData.email)) {\r\n      newErrors.email = \"Email is invalid\";\r\n    }\r\n\r\n    if (!formData.password) {\r\n      newErrors.password = \"Password is required\";\r\n    } else if (formData.password.length < 6) {\r\n      newErrors.password = \"Password must be at least 6 characters\";\r\n    }\r\n\r\n    setErrors(newErrors);\r\n    return Object.keys(newErrors).length === 0;\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {\r\n    e.preventDefault();\r\n    if (!validateForm()) return;\r\n\r\n    console.log('ðŸ”‘ Starting login submission...');\r\n    setIsSubmitting(true);\r\n\r\n    try {\r\n      // Check if there are guest cart items\r\n      const guestCartData = localStorage.getItem('guest_cart');\r\n      let hasGuestItems = false;\r\n      let itemCount = 0;\r\n\r\n      if (guestCartData) {\r\n        try {\r\n          const guestCart = JSON.parse(guestCartData);\r\n          hasGuestItems = guestCart?.items?.length > 0;\r\n          itemCount = guestCart?.items?.length || 0;\r\n        } catch (e) {\r\n          console.error('Error parsing guest cart:', e);\r\n        }\r\n      }\r\n\r\n      console.log('ðŸ›’ Has guest items to sync:', hasGuestItems, 'Count:', itemCount);\r\n\r\n      // Attempt login\r\n      const result = await login({\r\n        email: formData.email,\r\n        password: formData.password,\r\n      });\r\n\r\n      console.log('ðŸ“ Login result:', result);\r\n\r\n      if (result?.success) {\r\n        console.log('âœ… Login successful');\r\n\r\n        // Show success message\r\n        toast.success(result.message || \"Login successful!\");\r\n\r\n        // Handle cart sync result\r\n        if (result.cartSync) {\r\n          if (result.cartSync.success && result.cartSync.itemCount > 0) {\r\n            toast.success(result.cartSync.message || `${result.cartSync.itemCount} items transferred to your cart!`);\r\n          } else if (!result.cartSync.success) {\r\n            toast.warning(\"Login successful, but failed to transfer cart items. Your items are still saved locally.\");\r\n          }\r\n        }\r\n\r\n        // Navigate to home page after a short delay\r\n        setTimeout(() => {\r\n          console.log('ðŸ  Redirecting to home page');\r\n          if (result.user.role === \"admin\") {\r\n            navigate.replace(\"/admin-dashboard\");\r\n          } else {\r\n            navigate.replace(\"/user-dashboard\");\r\n          }\r\n        }, hasGuestItems ? 2000 : 1000); // Longer delay if there were items to sync\r\n\r\n      } else {\r\n        // Show specific error message from the server\r\n        const errorMessage = result?.message || 'Login failed. Please check your credentials.';\r\n        toast.error(errorMessage);\r\n\r\n        // Clear password field on error for security\r\n        setFormData(prev => ({\r\n          ...prev,\r\n          password: ''\r\n        }));\r\n      }\r\n    } catch (error: any) {\r\n      console.error('Login error:', error);\r\n      toast.error(error.message || \"An error occurred during login. Please try again.\");\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Container className=\"login-container top pt-5\">\r\n      <ToastContainer position=\"top-right\" autoClose={5000} />\r\n\r\n      <Row className=\"login-card shadow p-0\">\r\n        {/* Left Side */}\r\n        <Col md={6} className=\"login-left\">\r\n          <img\r\n            src={mushroomImg}\r\n            alt=\"Mushroom\"\r\n            className=\"img-fluid login-image\"\r\n          />\r\n        </Col>\r\n\r\n        {/* Right Side */}\r\n        <Col md={6} className=\"login-right p-4\">\r\n          <h2 className=\"titles mb-3\">Welcome back</h2>\r\n          <p className=\"para mb-4\">\r\n            Welcome back! Please login to your account\r\n          </p>\r\n\r\n          <form onSubmit={handleSubmit} className='g-8'>\r\n            {/* Email */}\r\n            <div className=\"login-input-group mb-3 position-relative\">\r\n\r\n              <div className=\"position-relative\">\r\n                <span className=\"position-absolute top-50 start-0 translate-middle-y ps-3 text-muted\">\r\n                  <FiMail />\r\n                </span>\r\n                <input\r\n                  type=\"email\"\r\n                  id=\"email\"\r\n                  name=\"email\"\r\n                  placeholder=\"Enter your email\"\r\n                  value={formData.email}\r\n                  onChange={handleChange}\r\n                  className={`form-control ps-5 pe-5 ${errors.email ? \"is-invalid\" : \"\"\r\n                    }`}\r\n                  disabled={isSubmitting}\r\n                  suppressHydrationWarning\r\n                />\r\n              </div>\r\n              {errors.email && (\r\n                <div className=\"invalid-feedback\">{errors.email}</div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Password */}\r\n            <div className=\"login-input-group mb-3 position-relative\">\r\n          \r\n              <div className=\"position-relative\">\r\n                <span className=\"position-absolute top-50 start-0 translate-middle-y ps-3 text-muted\">\r\n                  <FiLock />\r\n                </span>\r\n                <input\r\n                  type={showPassword ? \"text\" : \"password\"}\r\n                  id=\"password\"\r\n                  name=\"password\"\r\n                  placeholder=\"Enter your password\"\r\n                  value={formData.password}\r\n                  onChange={handleChange}\r\n                  className={`form-control ps-5 pe-5 ${errors.password ? \"is-invalid\" : \"\"\r\n                    }`}\r\n                  disabled={isSubmitting}\r\n                  suppressHydrationWarning\r\n                />\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => setShowPassword(!showPassword)}\r\n                  className=\"btn border-0 bg-transparent position-absolute end-0 top-50 translate-middle-y me-3\"\r\n                  suppressHydrationWarning\r\n                >\r\n                  {showPassword ? (\r\n                    <FiEyeOff className=\"text-muted\" />\r\n                  ) : (\r\n                    <FiEye className=\"text-muted\" />\r\n                  )}\r\n                </button>\r\n              </div>\r\n              {errors.password && (\r\n                <div className=\"invalid-feedback\">{errors.password}</div>\r\n              )}\r\n            </div>\r\n\r\n            <div className=\"text-center mt-4\">\r\n              <button\r\n                type=\"submit\"\r\n                className=\"button p-2 para border rounded w-100\"\r\n                disabled={isSubmitting}\r\n                suppressHydrationWarning\r\n              >\r\n                {isSubmitting ? \"Logging in...\" : \"Login\"}\r\n              </button>\r\n            </div>\r\n          </form>\r\n\r\n          <p className=\"mt-3 text-center\">\r\n            Don't have an account?{\" \"}\r\n            <span\r\n              style={{ cursor: \"pointer\" }}\r\n              onClick={() => navigate.push(\"/register\")}\r\n              className=\"color fw-bold\"\r\n            >\r\n              Register\r\n            </span>\r\n          </p>\r\n        </Col>\r\n      </Row>\r\n    </Container>\r\n  );\r\n};\r\n\r\nexport default Login;"],"names":[],"mappings":"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"}}]
}